---
layout: single
title: "Gemini와 WhisperAI로 만드는 음성인식 프로젝트 (2)"
---

## 'AccentAce - Gemini와 WhisperAI로 만드는 영어 학습 보조 도구' 코드 분석

## 코드 분석

#### Install

<script src="https://gist.github.com/juuyeoon/6fe0f893b7722c17a5b0be07fab5272c.js"></script>

우선 WhisperAI를 불러와서 사용하기 위해 OpenAI도 설치해 주었는데, 호환성 문제로 인해 0.28 버전으로 다운그레이드하여 설치하라는 조언에 따라 진행하였다.

웹앱 형태로 제작할 예정이라 Gradio를 설치하고, 웹에 서비스 하기 전 포트 번호를 체크하기 위해서 nmap도 함께 설치하였다.



#### API 설정 및 평가를 위한 세팅

<script src="https://gist.github.com/juuyeoon/4430d535cdaf01bed64d366ab5263b5d.js"></script>

설치받은 것들은 import 해주고, OpenAI에서 발급받은 API키도 입력하였다.

그리고 발음을 평가하기 위한 평가 문장을 설정하였는데, 해당 문장은 영어교육을 전공하신 선생님께 문장의 길이와 발음하는 단어의 난이도 그리고 시제 등을 고려하여 중간 난이도로 선별해서 제공해 주셨다.



발음 정확도를 평가하기 위한 함수를 먼저 작성하였다.

Expected words(기대하는 단어, 즉 예시 단어)과 Actual word(실제 단어, 즉 학생이 발음한 단어)를 비교할 수 있도록 split을 통해 단어 단위로 나누었다.

Correct count라는 변수와 for문을 통해서 예시 문장 속 단어와 실제 발음한 단어가 일치할 때마다 1씩 증가시켜 일치한 수만큼 저장하였다.

그래서 accuracy 라는 변수에 정확도를 계산하여 입력하였는데, 전체 기대하는 단어를 일치한 단어 수로 나누고, 백분위로 나타내었다.



발음 정확도에 따라 학생에게 피드백 하기 위한 함수를 이어서 작성하였다.

위에서 계산한 accuracy가 75~90 정도라면 중 수준에 해당하는 피드백을, 90 이상이라면 상 수준에 해당하는 피드백을 제공하며, 75 이하일 경우에는 하 수준에 해당하는 피드백을 제공하였다. (발음의 정확도를 높이는 연습을 위한 프로그램이니 허들을 조금 높게 잡았다.)



#### 정확도 측정과 분석, 그리고 웹앱 화면 구성

<script src="https://gist.github.com/juuyeoon/1d7fba4c5293ae6f64b136123ef1432a.js"></script>

다음으로는 각 단어별 정확도를 체크할 수 있는 함수를 작성하였다. transcribe_audio라는 이름의 함수로 작성하였는데, 여기서는 Whisper API를 직접 호출하여 오디오 파일의 결과값을 텍스트로 변환하는 작업부터 진행했다.

그리고 해당 텍스트 값을 위에서 작성한 calculate_accuracy를 통해 정확도를 계산하고, 그 값을 바탕으로 feedback 결과도 선택하도록 하였다.



각 단어별로 정확도를 분석하기 위해 또 단어 단위로 스플릿하고, for문을 통해 WhisperAI가 듣기에 두 단어가 동일했다면 O를 표시하도록 하고 틀린 단어는 X를 표시하도록 했다. 이는 추후에 웹앱에서 출력될 정보로, 어떤 단어를 잘못 발음하였는지 학생이 인지하도록 하는 보조 자료로 사용된다.



